<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.d16987a306a3d156a977.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.18.18"/><style data-styled="eWXuFb  dZTLiU cxhdwc fFoQnx eJXFLa bSuiGc liQTCq elkVYF fxovqS" data-styled-version="4.4.1">
/* sc-component-id: Nav__StyledNav-sc-10pvdn5-0 */
.eJXFLa{margin-bottom:1em;} @media (min-width:520px){.eJXFLa{margin-bottom:2em;}}
/* sc-component-id: Nav__StyledList-sc-10pvdn5-1 */
.bSuiGc{padding:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin-top:0;} @media (min-width:520px){.bSuiGc{display:block;}}
/* sc-component-id: Nav__ListElement-sc-10pvdn5-2 */
.liQTCq{display:inline-block;padding:0.5em;text-align:center;font-size:1.8rem;} @media (min-width:300px){.liQTCq{font-size:2.2rem;padding-right:0;padding-left:0;}} @media (min-width:350px){.liQTCq{font-size:2.2rem;}} @media (min-width:520px){.liQTCq{padding:0;margin-right:2rem;font-size:2.4rem;}} .liQTCq:after{content:' ';display:none;white-space:pre;} @media (min-width:520px){.liQTCq:after{display:inline-block;}}
/* sc-component-id: Nav__NavItem-sc-10pvdn5-3 */
.elkVYF{color:black;border:none;} .elkVYF:hover{color:blue;} .elkVYF:before{content:'/';display:none;} @media (min-width:520px){.elkVYF:before{display:inline;}} .elkVYF.active{font-weight:bold;}
/* sc-component-id: sc-global-724291793 */
html{line-height:1.15;-webkit-text-size-adjust:100%;} body{margin:0;} main{display:block;} h1{font-size:2em;margin:0.67em 0;} hr{box-sizing:content-box;height:0;overflow:visible;} pre{font-family:monospace,monospace;font-size:1em;} a{background-color:transparent;} abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;} b,strong{font-weight:bolder;} code,kbd,samp{font-family:monospace,monospace;font-size:1em;} small{font-size:80%;} sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;} sub{bottom:-0.25em;} sup{top:-0.5em;} img{border-style:none;} button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;} button,input{overflow:visible;} button,select{text-transform:none;} button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button;} button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;} button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText;} fieldset{padding:0.35em 0.75em 0.625em;} legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;} progress{vertical-align:baseline;} textarea{overflow:auto;} [type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;} [type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto;} [type="search"]{-webkit-appearance:textfield;outline-offset:-2px;} [type="search"]::-webkit-search-decoration{-webkit-appearance:none;} ::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;} details{display:block;} summary{display:list-item;} template{display:none;} [hidden]{display:none;} html,body{height:100%;} html{box-sizing:border-box;font-size:62.5%;} body{font-size:16px;font-size:1.6rem;font-family:'Bitter',monospace;word-break:break-word;} h1,h2,h3,h4,h5,h6{font-family:'Bitter',monospace;margin:0.5em 0;} *,*:before,*:after{box-sizing:inherit;} iframe{margin:0 auto;display:block;max-width:100%;width:100%;} iframe.youtube{height:20rem;} @media (min-width:550px){iframe.youtube{height:34rem;}} blockquote{margin-left:1em;margin-right:1em;} @media (min-width:520px){blockquote{margin-left:2em;margin-right:2em;}} figure{margin:0;} ul{padding:0;list-style:square;} a{-webkit-text-decoration:none;text-decoration:none;color:black;border-bottom:2px solid transparent;} a:hover{color:blue;border-color:blue;} a.anchor{border:none;} p{line-height:1.5em;font-size:1.8rem;} twitterwidget{margin:0 auto;} .sidebar{margin-left:auto;margin-right:auto;} @media (min-width:520px){.sidebar{width:calc(50% + 1em);clear:both;float:right;padding-left:1em;}} .sidebar.left{float:left;padding-left:0;padding-right:1em;} .sidebar img{width:100%;} .blog-full,.blog-inset{margin-left:auto;margin-right:auto;width:100%;} .blog-full img,.blog-inset img{width:100%;} @media (min-width:520px){.blog-inset{margin-top:2em;margin-bottom:2em;width:80%;}} .home-image{margin-left:auto;margin-right:auto;width:100%;} .home-image img{width:100%;} @media (min-width:520px){.home-image{margin-top:2em;margin-bottom:2em;width:100%;}} .blog-section{font-size:1.8rem;} .blog-section:not(:first-child){margin-top:2em;} .blog-section h1,.blog-section h2,.blog-section h3,.blog-section h4,.blog-section h5,.blog-section h6{margin-bottom:0.5em;} .blog-section h1 + p,.blog-section h2 + p,.blog-section h3 + p,.blog-section h4 + p,.blog-section h5 + p,.blog-section h6 + p{margin-top:0.5em;} .blog-section ul{margin-left:1.5em;} @media (min-width:520px){.blog-section ul{margin-left:2.5em;}} .blog-section li{margin:0.5em 0;line-height:1.5em;} .blog-section li p{margin:0;} :not(pre) > code[class*="language-"],pre[class*="language-"]{font-size:0.9em;} .gatsby-highlight-code-line{background-color:#feb;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:0.75em;border-left:0.25em solid #f99;} @media (min-width:520px){.gatsby-resp-image-wrapper{margin-top:2em;margin-bottom:2em;width:80%;}}
/* sc-component-id: Layout__Main-p46nka-0 */
.eWXuFb{max-width:83rem;padding:1em 1em 2em;margin:0 auto;} @media (min-width:350px){.eWXuFb{padding:1em 1.5em 4em;}} @media (min-width:520px){.eWXuFb{padding:2rem 2em 6rem;}}
/* sc-component-id: Layout__StyledTitle-p46nka-2 */
.cxhdwc{margin:0.3em 0;} @media (min-width:350px){.cxhdwc{margin:0.5em 0 0.2em;}} @media (min-width:520px){.cxhdwc{margin:0.667em 0;}}
/* sc-component-id: Layout__TitleLink-p46nka-3 */
.fFoQnx{color:#000;-webkit-text-decoration:none;text-decoration:none;border:none;} .fFoQnx:hover{color:#0000ff;}
/* sc-component-id: post__StyledPostDate-sd6zd6-0 */
.fxovqS{color:#999;font-weight:400;display:block;margin-top:1em;margin-bottom:1em;text-align:right;}</style><title data-react-helmet="true">Blair Nangle | Reverse engineering CloudFormation templates using CloudFormer — Route 53 example</title><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png"/><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Bitter:400,700" rel="stylesheet"/><meta data-react-helmet="true" name="theme-color" content="#ffffff"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:url" content="https://blairnangle.com"/><meta data-react-helmet="true" property="og:title" content="Reverse engineering CloudFormation templates using CloudFormer — Route 53 example"/><meta data-react-helmet="true" name="twitter:title" content="Reverse engineering CloudFormation templates using CloudFormer — Route 53 example"/><meta data-react-helmet="true" property="og:description" content="Reverse engineering CloudFormation templates using CloudFormer — Route 53 example"/><meta data-react-helmet="true" name="twitter:description" content="Reverse engineering CloudFormation templates using CloudFormer — Route 53 example"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-0260d8ea0081afed2988.js"/><link as="script" rel="preload" href="/app-56b2f03421b1b613f4bc.js"/><link as="script" rel="preload" href="/styles-b4c4c1714ba380118eec.js"/><link as="script" rel="preload" href="/commons-531b7f6f0285cf995cc1.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-b13622880cff5ad1eabd.js"/><link as="fetch" rel="preload" href="/page-data/blog/cloudformer/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><main class="Layout__Main-p46nka-0 eWXuFb"><header class="Layout__StyledHeader-p46nka-1 dZTLiU"><h1 class="Layout__StyledTitle-p46nka-2 cxhdwc"><a class="Layout__TitleLink-p46nka-3 fFoQnx" href="/">Blair Nangle</a></h1><nav class="Nav__StyledNav-sc-10pvdn5-0 eJXFLa"><ul class="Nav__StyledList-sc-10pvdn5-1 bSuiGc"><li class="Nav__ListElement-sc-10pvdn5-2 liQTCq"><a class="Nav__NavItem-sc-10pvdn5-3 elkVYF" href="/about/">about</a></li><li class="Nav__ListElement-sc-10pvdn5-2 liQTCq"><a class="Nav__NavItem-sc-10pvdn5-3 elkVYF" href="/blog/">blog</a></li><li class="Nav__ListElement-sc-10pvdn5-2 liQTCq"><a class="Nav__NavItem-sc-10pvdn5-3 elkVYF" href="/contact/">contact</a></li><li class="Nav__ListElement-sc-10pvdn5-2 liQTCq"><a class="Nav__NavItem-sc-10pvdn5-3 elkVYF" href="/elsewhere/">elsewhere</a></li></ul></nav></header><h1>Reverse engineering CloudFormation templates using CloudFormer — Route 53 example</h1><div><p>This post tries to explain how to work backwards from a functioning <strong>Route 53</strong> configuration to a codified <strong>CloudFormation</strong> file using Amazon Web Services’s <strong>CloudFormer</strong> tool. Note that at the time of writing CloudFormer is still in beta phase.</p><p>CloudFormer isn’t specific to Route 53 and can be used with a lot of other AWS services. I have chosen Route 53 as an example due to the relative simplicity of the configuration, at least in my example, compared to some other services and because I do not yet have a working version of a CloudFormation Route 53 template.</p><h4 id="prerequisites-and-assumptions" style="position:relative"><a href="#prerequisites-and-assumptions" aria-label="prerequisites and assumptions permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites and assumptions</h4><p>This post is written using the example of hosting a static website (or website front end) using AWS S3, CloudFront and Certificate Manager. That does not mean to say the same method cannot be applied to other configurations, only that any service-specific gotyas won’t be included.</p><h4 id="getting-started-creating-the-cloudformer-stack-with-cloudformation" style="position:relative"><a href="#getting-started-creating-the-cloudformer-stack-with-cloudformation" aria-label="getting started creating the cloudformer stack with cloudformation permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Getting started: Creating the CloudFormer stack with CloudFormation</h4><p>CloudFormer isn’t a first-class AWS service in the sense that you can’t navigate to it via the “Services” drop-down and it won’t appear if you try to search for it in the “Find a service by…” search bar, either. If your CloudFormation looks bare (in your <a href="https://aws.amazon.com/about-aws/global-infrastructure/">region</a>), you will just be able to select CloudFormer. If you already have stacks in your region, select “Create Stack” and then choose “CloudFormer” (under “Tools”) from the “Select a sample template” drop-down. Confusingly enough, in order to use CloudFormer (to ultimately create stacks of infrastructure) you must first create a stack for CloudFormer itself, hence the use of the generic stack creation wizard. (This feels to me like an unnecessary overhead that AWS could have avoided and maybe it will change if CloudFormer ever gets a full release but I couldn’t find any official information on the matter.)</p><p>Give your stack a name and choose a username and password – you will need these to log into your CloudFormer EC2 instance. This may seem like overkill for what we’re trying to achieve (and it may well be) but don’t worry, your EC2 instance only needs to be running for a few minutes while CloudFormer reverse engineers CloudFormation templates for the resources you select. According to the AWS <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-using-cloudformer.html">documentation</a>:</p><blockquote><p>CloudFormer is an AWS CloudFormation stack. You run CloudFormer by launching the stack from your AWS environment. It runs on a t2.medium Amazon EC2 instance and requires no other resources.</p></blockquote><p>If you’re just playing around with AWS and don’t have much in your account, you’re probably fine to just use the <a href="https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.html">default</a> VPC but if that’s not the case, you should create a new VPC in which your CloudFormer stack will be located.</p><p>Given that you are just going to be using this stack for executing CloudFormer tasks, you can leave all the fields and dropdowns in the “Options” stage blank.</p><p>Tick the checkbox to say that you’re cool with the fact that CloudFormation might create some IAM resources. It’s generic for stack creation and in this case a role with the various list and read <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_understand-policy-summary-access-level-summaries.html">permissions</a> will be created for the CloudFormer application so that it can do its thing. This will be deleted if you choose to delete your CloudFormer stack. Select “Create”. Once the status of your stack changes from <code class="language-text">CREATE_IN_PROGRESS</code> to <code class="language-text">CREATE_COMPLETE</code>, you’re good to go.</p><h4 id="accessing-and-using-the-cloudformer-tool" style="position:relative"><a href="#accessing-and-using-the-cloudformer-tool" aria-label="accessing and using the cloudformer tool permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Accessing and using the CloudFormer tool</h4><p>Navigate to your CloudFormer stack and then its “Outputs”. There should be one output. Click on its value. Enter your username and password when prompted.</p><p>Well done, you’re <em>finally</em> ready to use CloudFormer. Choose your region and hit “Create Template”. Entering “dns” in the filter box will automatically select any resources that fit that description. You’ll still have to navigate through all the other services, just leave them un-ticked. Check that the information on the “Summary” page makes sense and hit “Continue”.</p><p>Hopefully, you can now see your template. The NS and SOA records will not have been codified and will be created automatically when you create your new hosted zone. You can go ahead and delete your CloudFormer stack or just stop the EC2 instance on which it’s running if you want to play around a bit more.</p><h4 id="a-note-hosted-zone-names-and-ids" style="position:relative"><a href="#a-note-hosted-zone-names-and-ids" aria-label="a note hosted zone names and ids permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A Note: Hosted Zone Names and IDs</h4><p>It is possible to specify the hosted zone to attach record sets using either <code class="language-text">HostedZoneName</code> or <code class="language-text">HostedZoneId</code>. It’s also possible to have more than one hosted zone with the same name. However, the Hosted Zone IDs are unique and if you try to attach a record set or record set group to a hosted zone by defining the name and more than one hosted zone of that name exists, the stack creation will fail.</p><p>I have found that referencing the ID (see the template below) of the just-created hosted zone in the template to be more reliable than its name (CloudFormation just seems to complain a bit less).</p><h4 id="converting-to-yaml-optional" style="position:relative"><a href="#converting-to-yaml-optional" aria-label="converting to yaml optional permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Converting to YAML (optional)</h4><p>CloudFormer still only supports JSON output (despite AWS themselves <a href="https://aws.amazon.com/blogs/mt/the-virtues-of-yaml-cloudformation-and-using-cloudformation-designer-to-convert-json-to-yaml/">suggesting</a> that YAML should be the weapon of choice for CloudFormation). You will see the option to save your template to S3 but I prefer to copy and paste it into my relevant project so that it’s version-controlled. AWS provides a designer through the Console that can be used to convert JSON to YAML and there are other tools available but my preference is to use AWS Labs’s <a href="https://github.com/awslabs/aws-cfn-template-flip">aws-cfn-template-flip</a> command line tool.</p><p>By following the instructions on GitHub and replacing the masked (potentially sensitive) values where appropriate, your template should transform from this:</p><p>{% gist 38ee3601d1b327d2b6f7f6394c907e61 %}</p><p>To this:</p><p>{% gist 3adc4d9f209928a7b3b9d34e9ded05a0 %}</p><p>Note that <code class="language-text">HostedZoneId</code> is the same for <em>all</em> CloudFront distributions, that is, <code class="language-text">Z2FDTNDATAQYW2</code>. It also worth mentioning that I am choosing to keep all my files in the root of my project.</p><h4 id="deploying-your-template" style="position:relative"><a href="#deploying-your-template" aria-label="deploying your template permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deploying your template</h4><p>Before deploying your template it might be worth taking a screenshot or making a note of your current configuration, in case anything goes wrong.</p><p>There are two ways to proceed:</p><ul><li>Running a shell script to create the CloudFormation stack (faster)</li><li>Pushing your code to a hooked-up repo and letting CodePipeline do the stack creation (better)</li></ul><p>This post is going to follow the first option. I will have another post coming soon to explain how to create continuous delivery pipelines with CloudFormation and CodePipeline.</p><p>Firstly, we’ll need to delete your existing Route 53 hosted zone. Confirm that your website is no longer reachable using a new private browser window (in case of caching).</p><p>Next, you’ll want to create a <code class="language-text">parameters</code> file in which to extract any commonalities. This will be passed as an argument when we create the stack and has to be JSON. Note that CloudFormation will automatically add the period at the end of your top-level domain when creating the hosted zone and record sets. Mine looks like this:</p><p>{% gist 5401d47b70f118ffe127e8037fad805d %}</p><p>And my resultant template, after making use of some CloudFormation substitution syntax, looks like this:</p><p>{% gist d4272b79c7f04e8527d6e86dbeae6923 %}</p><p>Then execute the script below from the same directory as your YAML template.</p><p>{% gist bf58134a77a018fa4ad6302c00b5f061 %}</p><h4 id="name-servers-ns-and-start-of-authority-soa-records" style="position:relative"><a href="#name-servers-ns-and-start-of-authority-soa-records" aria-label="name servers ns and start of authority soa records permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Name servers (NS) and start-of-authority (SOA) records</h4><p>Each time you create a new hosted zone in Route 53, Amazon will automatically create NS (one, with four values) and SOA <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/SOA-NSrecords.html">records</a>. As far as I’m aware, there is no way to prescribe these for Route 53 — you must use the records created for you.</p><p>There is one final, manual step which involves updating the name servers of your registered domain. Note that the relationship between a registered domain and hosted zones is <a href="https://aws.amazon.com/route53/faqs/#create_multiple_hzs_for_same_domain">one-to-many</a>. When you executed the above script and Route 53 generated a new name server record (with four entries), your domain’s name servers weren’t updated and remained as they were for the first hosted zone you (manually) created in your domain.</p><p>If you navigate to Route 53 &gt; Registered domains &gt; <em>Your Domain</em> and check out the list of name servers, you will see that they no longer match the list of addresses in the “Value” field of the “NS” record in your hosted zone. All that remains to be done is to update the name servers values on the registered domain page with the values from your hosted zone record.</p><p><a href="https://serverfault.com/questions/838330/deleted-then-recreated-route-53-hosted-zones-now-website-not-working/838396#838396">This</a> <em>Server Fault</em> answer does a better job of explaining it than I do.</p><h4 id="has-it-worked" style="position:relative"><a href="#has-it-worked" aria-label="has it worked permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Has it worked?</h4><p>Validating that the stack creation has been successful is easy: just navigate to CloudFormation via the AWS Console and, like before with the CloudFormer stack, (hopefully) watch the status change from <code class="language-text">CREATE_IN_PROGRESS</code> to <code class="language-text">CREATE_COMPLETE</code>.</p><p>If the creation of the stack has been unsuccessful, CloudFormation will try to rollback to the previous (successful) version. Given that this is the first version of the stack and CloudFormation has nothing to which it can rollback, you will have to manually delete the failed stack before tweaking your template and retrying.</p><p>To validate that the DNS setup is functioning correctly, the first thing to do is check that everything looks as before in Route 53. Frustratingly, due to DNS propagation <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/troubleshooting-new-dns-settings-not-in-effect.html">times</a>, you won’t be able to <em>fully</em> validate that your new configuration is functional straight away.</p><h4 id="next" style="position:relative"><a href="#next" aria-label="next permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Next</h4><p>This is a very simple example and it’s unlikely that you’ll want to regular programmatically deploy Route 53 configurations, though, of course, it is always useful to have them codified. I just wanted to show the power of CloudFormer, especially if you’re someone (like me) who has spent a long time painfully tweaking CloudFormation templates.</p></div><time class="post__StyledPostDate-sd6zd6-0 fxovqS">2018-10-01</time></main></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-124521773-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/cloudformer/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-56b2f03421b1b613f4bc.js"],"component---src-templates-post-js":["/component---src-templates-post-js-b13622880cff5ad1eabd.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-10fe27034e8935e6ec6a.js"],"component---src-pages-index-js":["/component---src-pages-index-js-328d86e91ca0fd426892.js"],"component---src-pages-contact-mdx":["/component---src-pages-contact-mdx-7b2006e7cfbcb4818325.js"],"component---src-pages-elsewhere-mdx":["/component---src-pages-elsewhere-mdx-7813f89b483220efd1ee.js"],"component---src-pages-about-mdx":["/component---src-pages-about-mdx-d00b184cfa955207f719.js"]};/*]]>*/</script><script src="/component---src-templates-post-js-b13622880cff5ad1eabd.js" async=""></script><script src="/commons-531b7f6f0285cf995cc1.js" async=""></script><script src="/styles-b4c4c1714ba380118eec.js" async=""></script><script src="/app-56b2f03421b1b613f4bc.js" async=""></script><script src="/webpack-runtime-0260d8ea0081afed2988.js" async=""></script></body></html>